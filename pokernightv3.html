<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Pokeravond Rekentool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <h2>Pokeravond Rekentool</h2>

  <div class="no-print">
    <div class="host-container no-print">
      <div class="host-fields">
        <div class="host-input">
          <label for="host-name">Naam van de host:</label>
          <input type="text" id="host-name" placeholder="Bijv. Jan Jansen" oninput="updateSessionInfo()"/>
        </div>
        <div class="date-input">
          <label for="session-date">Datum van sessie:</label>
          <input type="date" id="session-date" oninput="updateSessionInfo()"/>
        </div>
      </div>
    </div>
    <br />
    <button onclick="voegSpelerToe()">+ Speler toevoegen (max 9)</button>
    <button onclick="resetData()">Reset gegevens</button>
    <button onclick="window.print()">Print overzicht</button>
    <button onclick="endSession()">Einde sessie (lokaal opslaan)</button>
    <button onclick="window.location.href='history.html'">Bekijk Geschiedenis</button>

  </div>

  <table id="pokertable">
    <thead>
      <tr>
        <th>Speler</th>
        <th>Inkopen (€10)</th>
        <th>Ingelegd</th>
        <th>Eindwaarde</th>
        <th>Winst/Verlies</th>
        <th>Verwijder</th>
      </tr>
    </thead>
    <tbody id="table-body"></tbody>
  </table>

  <div class="summary">
    <p id="totaal-ingelegd">Totaal ingelegd: €0</p>
    <p id="totaal-eindwaarde">Totaal eindwaarde: €0</p>
    <p id="verschil">Verschil (moet €0 zijn): €0</p>
  </div>

  <script>
    let spelersAantal = 0;
    const MAX_SPELERS = 9;

    function createSpelerRow(data = {}) {
      if (spelersAantal >= MAX_SPELERS) return;

      const tbody = document.getElementById('table-body');
      const row = document.createElement('tr');

      row.innerHTML = `
        <td><input type="text" value="${data.naam || 'Speler ' + (spelersAantal + 1)}" class="naam" oninput="saveData()"></td>
        <td>
          <div class="controls">
            <button onclick="pasInkoopAan(this, -1)">–</button>
            <span class="inkopen">${data.inkopen || 0}</span>
            <button onclick="pasInkoopAan(this, 1)">+</button>
          </div>
        </td>
        <td class="ingelegd">€0</td>
        <td><input type="number" min="0" value="${data.eindwaarde || 0}" class="eindwaarde" oninput="bereken()"></td>
        <td class="resultaat">€0</td>
        <td><button class="removebtn" onclick="verwijderSpeler(this)">Verwijder</button></td>
      `;

      tbody.appendChild(row);
      spelersAantal++;
    }

    function voegSpelerToe() {
      createSpelerRow();
      bereken();
    }

    function pasInkoopAan(btn, delta) {
      const span = btn.parentElement.querySelector('.inkopen');
      let huidige = parseInt(span.textContent) || 0;
      huidige = Math.max(0, huidige + delta);
      span.textContent = huidige;
      bereken();
    }

    function verwijderSpeler(button) {
      if (confirm("Weet je zeker dat je deze speler wilt verwijderen?")) {
        const row = button.closest('tr');
        row.remove();
        spelersAantal--;
        bereken();
      }
    }

    function bereken() {
      const rows = document.querySelectorAll('#pokertable tbody tr');
      let totaalIngelegd = 0;
      let totaalEindwaarde = 0;
      const players = [];

      rows.forEach(row => {
        const naam = row.querySelector('.naam').value;
        const inkopen = parseInt(row.querySelector('.inkopen').textContent) || 0;
        const ingelegd = inkopen * 10;
        const eindwaarde = parseFloat(row.querySelector('.eindwaarde').value) || 0;
        const resultaat = eindwaarde - ingelegd;

        row.querySelector('.ingelegd').textContent = `€${ingelegd}`;
        const resultaatCell = row.querySelector('.resultaat');
        resultaatCell.textContent = (resultaat >= 0 ? '+' : '') + `€${resultaat}`;
        resultaatCell.className = 'resultaat ' + (resultaat >= 0 ? 'winst' : 'verlies');

        totaalIngelegd += ingelegd;
        totaalEindwaarde += eindwaarde;

        players.push({ naam, inkopen, eindwaarde, ingelegd, resultaat, timestamp: new Date().toISOString() });
      });

      document.getElementById('totaal-ingelegd').textContent = `Totaal ingelegd: €${totaalIngelegd}`;
      document.getElementById('totaal-eindwaarde').textContent = `Totaal eindwaarde: €${totaalEindwaarde}`;
      document.getElementById('verschil').textContent = `Verschil (moet €0 zijn): €${totaalEindwaarde - totaalIngelegd}`;

      const session = {
        hostName: document.getElementById('host-name').value,
        sessionDate: document.getElementById('session-date').value,
        players
      };

      localStorage.setItem('pokeravond_current', JSON.stringify(session));
    }

    function resetData() {
      if (confirm("Weet je zeker dat je alles wilt wissen?")) {
        localStorage.removeItem('pokeravond_data');
        document.getElementById('table-body').innerHTML = '';
        spelersAantal = 0;
        for (let i = 0; i < 4; i++) voegSpelerToe();
        bereken();
      }
    }

    function loadData() {
      const savedSession = JSON.parse(localStorage.getItem('pokeravond_current')) || {};
      const savedPlayers = savedSession.players || [];

      // Set host name and session date
      document.getElementById('host-name').value = savedSession.hostName || '';
      document.getElementById('session-date').value = savedSession.sessionDate || new Date().toLocaleDateString();

      // Populate the table with player data
      document.getElementById('table-body').innerHTML = '';
      spelersAantal = 0;
      savedPlayers.forEach(speler => createSpelerRow(speler));

      // If no players are saved, add 4 new rows by default
      if (savedPlayers.length === 0) {
        for (let i = 0; i < 4; i++) voegSpelerToe();
      }

      bereken();
    }

    function updateSessionInfo() {
      const hostName = document.getElementById('host-name').value;
      const sessionDate = document.getElementById('session-date').value;

      const currentSession = JSON.parse(localStorage.getItem('pokeravond_current')) || {};

      currentSession.hostName = hostName;
      currentSession.sessionDate = sessionDate;

      localStorage.setItem('pokeravond_current', JSON.stringify(currentSession));
    }

    function endSession() {
      const session = JSON.parse(localStorage.getItem('pokeravond_current'));
      if (!session) return;

      // Get history array or create new
      const history = JSON.parse(localStorage.getItem('pokeravond_history')) || [];

      // Add current session to history
      history.push(session);
      localStorage.setItem('pokeravond_history', JSON.stringify(history));

      // Clear current session
      localStorage.removeItem('pokeravond_current');

      // Reload page to fresh state
      alert("Sessie opgeslagen. Nieuwe sessie gestart.");
      location.reload();
    }

    // Initial load
    loadData();
  </script>

</body>
</html>
